# Shipping Service

Decisions:

| Date      | Decision                                                                                                 | Reason / Explanation                                                                                                                                                                                                                                                                                                                                                                  | Doubts                                                                                                                                                                                                                   |
|-----------|----------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <04/11/24 | We use the handler pattern to implement event-driven business logic, e.g OrderConfirmedEventHandler      | The handler pattern is a good fit, as it encapsulates all relevant business logic per event that happens. The alternative would be to use aggregate level services, which would result in a large chunk of Business logic in one class.                                                                                                                                               | This might leads to code duplication (like create a shipment and save it to the database) or use a lot of                                                                                                                |
| <04/11/24 | We allow the re-use of command-handlers like autowiring CreateShipment into another thing                | We dont want to have code duplication                                                                                                                                                                                                                                                                                                                                                 | We will probably get into dependency hell + we need to adjust the calling code to match restraints set by the handler. e.g CreateShipment needing a special DTO                                                          |
| <04/11/24 | We organise our repository in 5 layers, application, domain, infrastructure, ui & web                    | Domain is where our entities and their outside world representations live including all events that are relevant for our system. Infrastructure provides interfaces and implementations for Messaging systems and Databases. Application connects infrastructure and domain layer and manages larger transactions. Web is responsible for REST controllers and kafka event listeners. |                                                                                                                                                                                                                          |
|           | We treat DomainEvents and Commands both as Messages, just different permutations of it                   | This allows us to design slim interfaces for the eventPublisher                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           | We publish only two stock events: AvailableStockAdjusted and StockCritical                               | Letting others keep track of stock does not make sense as it will always be stale, they can still do so if they like (by looking inside the event), but we don't need different event types for that.                                                                                                                                                                                 |                                                                                                                                                                                                                          |
|           | We wont publish events about stock being reserved, as we will just decrease/increase the available stock | This is the only important metric to the outside world, no one needs to know how much stock is reserved currently                                                                                                                                                                                                                                                                     | One could argue, that purchasing / analytics needs to know this, in order to track something, but we think most can be accomplished with success rates from ShipmentRequested -> ShipmentDelivered/Sent or other metrics |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |
|           |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                          |

